javascript:(() => {

  function delay(time) {
    return new Promise(r => setTimeout(r, time));
  }

  function getSavedData() {
    const data = localStorage.getItem("QuizletSaved")  || "{}";
    return JSON.parse(data);
  }

  const data = getSavedData();

  function translate(requested) {
    return (data.hasOwnProperty(requested.trim()) && data[requested.trim()]) || null
  };

  function getData() {
    const elements = Array.from(document.querySelectorAll("span.TermText.notranslate"));
    for (let i = 0; i < elements.length - 1; i ++) {
      const lastElement = elements[i];
      const nextElement = elements[i+1];

      data[lastElement.innerText.trim()] = nextElement.innerText.trim();
      data[nextElement.innerText.trim()] = lastElement.innerText.trim();
    }
  };

  async function complete(iterations) {
    const translateElement = document.querySelector(".FormattedText.notranslate");
    const translation = translate(translateElement.innerText);

    if (translation) {
      const writeElement = document.querySelector(".AutoExpandTextarea-textarea");
      const nextButton = document.querySelector('button.UIButton[type="submit"]');
      if (writeElement) {
        writeElement.value = translation;
        writeElement.dispatchEvent(new InputEvent("input", {bubbles : true, cancelable : true}));
        await delay(200);
        nextButton.click();
      } else {
        const potentialAnswerElements = document.querySelectorAll(".AutoExpandTextarea-textarea");
        let answerElement;
        for (let i = 1; i < potentialAnswerElements.length; i++) {
          answerElement = potentialAnswerElements[i];
          if (answerElement.innerText.trim() == translation) {
            break
          }
        };
        if (answerElement) {
          answerElement.dispatchEvent(new MouseEvent("click", {bubbles:true, cancelable:true}));
          await delay(200);
        } else {
          alert("no answer for " + translation);
        }
      }
    } else {
      alert("no translation for " + translateElement.innerText);
    }
  }

  function createGui() {
    const div = document.createElement("div");
    div.style = "z-index: 9999; top: 0%; left: 0%; height: 24px; width: 100%;";

    const input = document.createElement("input");
    input.style.width = "60px";
    div.appendChild(div);

    let label = document.createElement("p");

    function createButton(text, cb) {
      const button = document.createElement("button");
      button.textContent = text;
      button.addEventListener("click", cb);
      div.appencChild(button);
    };

    function translateShow() {
      const translation = translate(input.value);
      if (translation) {
        label.textContent = translation;
      } else {
        label.textContent = "___";
      }
    }

    let stopcompleting = () => {};

    const completeButton = createButton("complete", async () => {
      try {
        const amt = parseFloat(input.value);
        for (let i = 0; i < amt; i ++) {
          stopcompleting = () => {break};
          await complete();
        }
      } catch (err) {
        console.log(err);
      }
    });
    const stopButton = createButton("stop", stopcompleting);

    const getData = createButton("get", getData);

    input.addEventListener(input, translateShow);

    document.appendChild(div);
  }

})();
